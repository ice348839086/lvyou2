# 测试指南 - AI行程规划功能

## 🎯 测试目标

验证AI行程规划的完整流程，包括：
1. 数据输入
2. AI生成
3. 方案展示
4. 详情查看
5. 错误处理

## 📋 测试前准备

### 1. 环境配置检查

```bash
# 确保 .env.local 文件存在并配置正确
DEEPSEEK_API_KEY=your_actual_api_key
DEEPSEEK_API_URL=https://api.deepseek.com/v1
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问: http://localhost:3000

## 🧪 测试用例

### 测试用例 1: 基本流程测试

**目标**: 验证完整的行程生成和查看流程

**步骤**:
1. 访问首页，点击"AI智能规划"
2. 填写表单：
   - 目的地: 北京
   - 开始日期: 明天
   - 结束日期: 3天后
   - 成人: 2人
   - 旅行节奏: 标准
   - 兴趣偏好: 勾选"历史文化"和"美食体验"
3. 点击"生成AI行程"
4. 等待生成（30-60秒）
5. 查看3个方案是否正确显示
6. 点击任意方案的"查看完整行程"按钮
7. 验证详情页显示

**预期结果**:
- ✅ 表单验证正常
- ✅ 生成进度显示正常
- ✅ 显示3个不同风格的方案
- ✅ 每个方案显示标题、描述、景点数量
- ✅ 点击按钮跳转到详情页
- ✅ 详情页显示完整的每日行程
- ✅ 显示AI推荐理由和小贴士

### 测试用例 2: 错误处理测试

**目标**: 验证各种错误情况的处理

#### 2.1 日期验证
**步骤**:
1. 不填写日期，直接点击"生成AI行程"

**预期结果**:
- ✅ 按钮禁用状态（灰色，无法点击）

#### 2.2 日期范围验证
**步骤**:
1. 设置超过10天的行程
2. 点击"生成AI行程"

**预期结果**:
- ✅ 显示错误提示："请选择1-10天的行程"

#### 2.3 API错误处理
**步骤**:
1. 临时修改 .env.local 中的 API Key 为无效值
2. 填写表单并生成

**预期结果**:
- ✅ 显示详细的错误信息
- ✅ 错误提示样式正确（红色边框，图标）
- ✅ 可以返回继续修改

### 测试用例 3: UI交互测试

**目标**: 验证所有交互元素

**步骤**:
1. 测试所有按钮的悬停效果
2. 测试"返回方案列表"按钮
3. 测试"选择其他方案"按钮
4. 测试"重新规划"按钮

**预期结果**:
- ✅ 按钮悬停有阴影效果
- ✅ 所有导航按钮功能正常
- ✅ 页面切换有淡入动画

### 测试用例 4: 数据完整性测试

**目标**: 验证AI返回的数据结构

**步骤**:
1. 生成行程后，打开浏览器开发者工具
2. 查看 Console 日志
3. 查看 Network 标签中的 API 响应

**预期结果**:
- ✅ Console 无错误日志
- ✅ API 返回 200 状态码
- ✅ 返回数据包含 `plans` 数组
- ✅ 每个方案包含 `dailyPlans`
- ✅ 每个活动包含必要字段（time, name, type, duration）

### 测试用例 5: 不同配置测试

**目标**: 验证不同参数组合

#### 5.1 不同目的地
- 北京
- 上海
- 杭州
- 成都

#### 5.2 不同人数组合
- 单人游（1成人）
- 情侣游（2成人）
- 家庭游（2成人 + 1儿童）
- 带老人（2成人 + 1老人）

#### 5.3 不同节奏
- 休闲（2-3个景点/天）
- 标准（3-4个景点/天）
- 紧凑（4-5个景点/天）

#### 5.4 不同兴趣组合
- 单个兴趣
- 多个兴趣
- 所有兴趣

**预期结果**:
- ✅ 所有组合都能正常生成
- ✅ 生成的方案符合选择的参数

## 🔍 调试技巧

### 查看详细日志

1. **浏览器 Console**
   - 打开开发者工具 (F12)
   - 查看 Console 标签
   - 查找 "Parsing JSON" 和 "AI Response" 日志

2. **服务器日志**
   - 查看运行 `npm run dev` 的终端
   - 查找错误堆栈信息

3. **Network 请求**
   - 开发者工具 -> Network 标签
   - 找到 `generate-itinerary` 请求
   - 查看 Request Payload 和 Response

### 常见问题排查

#### 问题 1: "AI返回的数据格式不正确"

**可能原因**:
- AI返回了markdown包裹的JSON
- JSON格式有语法错误
- 缺少必要字段

**排查步骤**:
1. 查看 Console 中的 "Response content" 日志
2. 检查返回的原始内容
3. 验证JSON格式是否正确

**解决方案**:
- 代码已经增强了JSON解析，支持多种格式
- 如果仍有问题，查看具体的错误信息

#### 问题 2: 方案无法点击

**可能原因**:
- JavaScript错误导致事件未绑定
- 按钮被其他元素遮挡

**排查步骤**:
1. 检查 Console 是否有错误
2. 检查按钮的 onClick 事件是否存在
3. 使用开发者工具检查元素

**解决方案**:
- 已添加 onClick 事件处理
- 确保没有 z-index 冲突

#### 问题 3: 详情页不显示

**可能原因**:
- 状态管理问题
- 数据结构不匹配

**排查步骤**:
1. 检查 `step` 状态是否为 'detail'
2. 检查 `selectedPlan` 是否有值
3. 检查 `dailyPlans` 数组是否存在

**解决方案**:
- 使用可选链操作符 `?.` 避免空值错误
- 验证数据结构完整性

## ✅ 测试检查清单

### 功能测试
- [ ] 表单输入正常
- [ ] 表单验证正常
- [ ] AI生成正常
- [ ] 进度显示正常
- [ ] 方案列表显示正常
- [ ] 方案卡片可点击
- [ ] 详情页显示正常
- [ ] 返回按钮正常
- [ ] 重新规划按钮正常

### UI测试
- [ ] 布局响应式
- [ ] 动画效果正常
- [ ] 按钮悬停效果
- [ ] 错误提示样式
- [ ] 时间轴显示正常
- [ ] 图标显示正常

### 数据测试
- [ ] API调用成功
- [ ] 数据解析正常
- [ ] 数据验证通过
- [ ] 类型检查无错误

### 错误处理
- [ ] 日期验证
- [ ] API错误提示
- [ ] 数据格式错误提示
- [ ] 网络错误处理

## 📊 性能测试

### 响应时间
- 表单提交: < 100ms
- AI生成: 30-60秒（取决于API）
- 页面切换: < 300ms

### 资源使用
- 内存占用: 正常
- CPU占用: 生成时较高，其他时间正常
- 网络请求: 仅必要请求

## 🎓 测试报告模板

```markdown
## 测试报告

**测试日期**: 2026-01-22
**测试人员**: [姓名]
**测试环境**: 
- 浏览器: Chrome 120
- 操作系统: Windows 11
- Node版本: 20.x

### 测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 基本流程 | ✅ | 正常 |
| 错误处理 | ✅ | 正常 |
| UI交互 | ✅ | 正常 |
| 数据完整性 | ✅ | 正常 |
| 不同配置 | ✅ | 正常 |

### 发现的问题

1. [问题描述]
   - 严重程度: 高/中/低
   - 复现步骤: ...
   - 预期结果: ...
   - 实际结果: ...

### 改进建议

1. [建议内容]
```

## 🔗 相关文档

- [CHANGELOG.md](./CHANGELOG.md) - 更新日志
- [README.md](./README.md) - 项目说明
- [QUICK_START.md](./QUICK_START.md) - 快速开始
