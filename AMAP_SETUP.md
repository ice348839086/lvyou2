# 🗺️ 高德地图 API Key 配置指南

## 问题说明

错误 `USERKEY_PLAT_NOMATCH` 表示高德地图 API Key 配置有问题。

## 解决步骤

### 1. 获取高德地图 API Key

1. **访问高德开放平台**
   - 网址: https://console.amap.com/
   - 如果没有账号,先注册一个(免费)

2. **创建应用**
   - 登录后,点击"应用管理" → "我的应用"
   - 点击"创建新应用"
   - 填写应用名称(如: "智旅App")
   - 填写应用类型: 选择 "Web应用"

3. **添加 Key**
   - 在应用下点击"添加Key"
   - **Key名称**: 随便填(如: "开发环境")
   - **服务平台**: **必须选择 "Web端(JS API)"** ⚠️ 这是关键!
   - 点击"提交"

4. **配置安全密钥(重要!)**
   - 在Key列表中,找到刚创建的Key
   - 点击"设置" → "安全密钥"
   - 在"域名白名单"中添加:
     ```
     localhost
     127.0.0.1
     localhost:3000
     ```
   - 保存设置

5. **复制 Key**
   - 复制显示的 Key (一串字符)

### 2. 配置环境变量

1. **编辑 `.env.local` 文件**
   
   在项目根目录 `c:\code\linglong\travel-app-2.0\` 下,编辑 `.env.local` 文件:

   ```env
   # 高德地图API Key (必需)
   NEXT_PUBLIC_AMAP_KEY=你复制的Key

   # DeepSeek API Key (可选,用于AI功能)
   DEEPSEEK_API_KEY=your_deepseek_api_key_here
   DEEPSEEK_API_URL=https://api.deepseek.com/v1
   ```

   **注意**: 
   - 替换 `你复制的Key` 为你在步骤1中复制的实际Key
   - 不要有多余的空格或引号
   - 确保变量名是 `NEXT_PUBLIC_AMAP_KEY` (不是 `AMAP_KEY`)

2. **保存文件**

### 3. 重启开发服务器

1. **停止当前服务器**
   - 在终端按 `Ctrl + C`

2. **重新启动**
   ```bash
   npm run dev
   ```

3. **刷新浏览器**
   - 访问 http://localhost:3000
   - 地图应该正常显示了

## 常见问题

### Q1: 还是显示 `USERKEY_PLAT_NOMATCH` 错误?

**可能原因:**
- ✅ 检查 Key 的服务平台是否选择了 "Web端(JS API)"
- ✅ 不要选择 "Web服务" 或其他平台
- ✅ 确认 `.env.local` 文件中的变量名是 `NEXT_PUBLIC_AMAP_KEY`
- ✅ 确认已经重启了开发服务器

### Q2: 地图显示空白?

**解决方法:**
1. 打开浏览器控制台(F12)
2. 查看是否有错误信息
3. 检查域名白名单是否配置正确
4. 确认 Key 没有过期或被禁用

### Q3: 提示 "INVALID_USER_KEY"?

**解决方法:**
- Key 可能输入错误,重新复制粘贴
- 检查 Key 前后是否有空格
- 确认 Key 状态是"启用"

### Q4: 不想配置地图,能用吗?

**可以!** 应用已经做了兼容处理:
- 没有配置 Key 时,地图区域会显示提示信息
- 景点列表和筛选功能仍然可以正常使用
- 只是无法在地图上查看景点位置

## 免费额度

高德地图提供免费额度:
- **个人开发者**: 每天 30万次 API 调用
- **企业开发者**: 每天 100万次 API 调用
- 对于开发和测试完全够用

## 测试是否配置成功

配置完成后,访问 http://localhost:3000:

✅ **成功标志:**
- 页面中央显示地图
- 地图上有景点标记
- 可以拖动和缩放地图
- 点击标记显示景点信息

❌ **失败标志:**
- 地图区域显示错误信息
- 浏览器控制台有 `USERKEY_PLAT_NOMATCH` 错误
- 地图区域完全空白

## 需要帮助?

如果按照以上步骤还是无法解决:

1. 检查浏览器控制台的完整错误信息
2. 确认高德开放平台账号状态正常
3. 尝试创建一个新的 Key
4. 查看高德地图官方文档: https://lbs.amap.com/api/javascript-api-v2/guide/abc/prepare

---

**配置成功后,就可以愉快地使用地图功能了! 🎉**
